<!DOCTYPE html>

<html>
  <head>
    <title>Apg coder</title>
    <meta name="LifeViewer" content="viewer code">
    <style>
      body {
        width: 640px;
      }
      div.codebox {
        font-family: 'Courier New', Courier, monospace;
        background-color: #FFFFFF;
        border: 1px solid #d8d8d8;
        width: 560px !important;
        display: inherit;
      }
      div.selall {
        text-transform: uppercase;
        border-bottom: 1px solid #CCCCCC;
        font-size: 0.8em;
        font-weight: bold;
        display: inherit
      }
      * {
        cursor: auto;
        text-align: center !important;
        align-items: center !important;
        align-self: center !important;
        align-content: center !important;
      }
      *:not(pre, code) {
        font-family: Arial, Helvetica, sans-serif;
      }
      pre, code {
        font-family:'Courier New', Courier, monospace;
      }
      a {
        color: #04F;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      #code0, #code1, #view {
        display: none;
        width: 560px;
      }
      fieldset {
        width: 600px;
        padding: 20px;
      }
      canvas {
        width: 560px !important;
        height: 300px !important;
      }
      #viewspace {
        width: 550px;
        margin: 20px;
      }
    </style>
  </head>
  <body>
    <h1>APGcoder</h1>
    <p>APGcode is from <a href="https://catagolue.appspot.com/">Catagolue</a>.</p>
    <form method="GET">
      <fieldset>
        <legend>APGcoding</legend>
        <p>Enter text: <input name="text" type="text" id="text" /></p>
        <p>Enter rule: <input name="rule" type="text" id="rule" /></p>
        <div id="viewspace" style="align-self: center;">
          <div class="codebox">
            <div class="selall">
              Code: <a href="" onclick="selectCode(this); return false;">Select all</a>
            </div>
            <div>
              <code id="code0"></code>
            </div>
          </div>
          <div class="viewer">
            <code id="code1"></code>
            <br>
            <canvas id="view"></canvas>
          </div>
          <a id="a"></a>
        </div>
        <button type="submit" id="go">Go!</button>
      </fieldset>
    </form>
  </body>
  <script src="http://catagolue.appspot.com/js/rle_tools.js"></script>
  <script src="http://catagolue.appspot.com/js/codebox.js"></script>
  <script>
    document.getElementById("rule").value = "B3/S23";
    var loc = window.location.href;
    var query = (function(a) {
      if (a.split("?").length == 1) { return 0 }
      var parts = decodeURIComponent(a).split("?")[1].split("&");
      var data = {};
      for (i of parts) {
        var j = i.split("=");
        data[j[0]] = j[1]
      }
      document.getElementById("text").value = data.text;
      document.getElementById("rule").value = data.rule;
      var rle = cells_to_rle(decodeCanon("xp0_" + data.text)).replace("B3/S23", data.rule).replace("<br>", "\n");
      document.getElementById("code0").innerText = rle;
      document.getElementById("code1").innerText = rle + "\n#C [[ THEME 6 GPS 20 ]]";
      document.getElementById("code0").style = "display: inherit;";
      document.getElementById("view").style = "display: inherit;";
    })(loc);
  </script>
  <script src="http://catagolue.appspot.com/js/lv-plugin.js"></script>
</html>